<div class="messages-page">
  <!-- Header -->
  <div class="header-stats">
    <div class="stat-item total">
      <span class="stat-number">{{ formatNumber(totalCount) }}</span>
      <span class="stat-label">Total</span>
    </div>
    <div class="stat-item unread">
      <span class="stat-number">{{ formatNumber(unreadCount) }}</span>
      <span class="stat-label">Unread</span>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="Search messages..." [(ngModel)]="searchTerm">
    </div>
    <div class="filter-buttons">
      <button class="filter-btn" [class.active]="filterStatus === 'all'" (click)="filterStatus = 'all'">
        All
      </button>
      <button class="filter-btn" [class.active]="filterStatus === 'unread'" (click)="filterStatus = 'unread'">
        Unread
      </button>
      <button class="filter-btn" [class.active]="filterStatus === 'read'" (click)="filterStatus = 'read'">
        Read
      </button>
    </div>
  </div>

  <!-- Messages List -->
  <div class="messages-container">
    @if (filteredMessages.length > 0) {
    <div class="messages-list">
      @for (message of filteredMessages; track message.id) {
      <div class="message-card" [class.unread]="!message.read" (click)="openMessage(message)">
        <div class="message-avatar">
          <i class="fas fa-user"></i>
          @if (!message.read) {
          <div class="unread-indicator"></div>
          }
        </div>
        <div class="message-content">
          <div class="message-header">
            <h4>{{ message.name }}</h4>
            <span class="message-time">{{ getTimeAgo(message.timestamp) }}</span>
          </div>
          <p class="message-subject">{{ message.subject }}</p>
          <p class="message-preview">{{ message.message.substring(0, 100) }}...</p>
          <div class="message-meta">
            <span class="message-email">{{ message.email }}</span>
            <span class="message-date">{{ getTimeAgo(message.timestamp) }}</span>
          </div>
        </div>
        <div class="message-actions">
          @if (!message.read) {
          <button class="btn btn-sm btn-secondary" (click)="$event.stopPropagation(); markAsRead(message.id!)"
            title="Mark as read">
            <i class="fas fa-check"></i>
          </button>
          }
          <button class="btn btn-sm btn-danger" (click)="$event.stopPropagation(); deleteMessage(message.id!)"
            title="Delete">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3>No Messages Found</h3>
      <p>{{ searchTerm ? 'No messages match your search criteria.' : 'No messages yet. Messages from your contact form
        will appear here.' }}</p>
    </div>
    }
  </div>

  <!-- Message Detail Modal -->
  @if (isModalOpen && selectedMessage) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="message-info">
          <h2>{{ selectedMessage.subject }}</h2>
          <p class="message-meta">
            From: {{ selectedMessage.name }} ({{ selectedMessage.email }})
          </p>
        </div>
        <div class="modal-actions">
          @if (!selectedMessage.read) {
          <button class="btn btn-secondary btn-sm" (click)="markAsRead(selectedMessage.id!)" title="Mark as read">
            <i class="fas fa-check"></i>
            Mark as Read
          </button>
          }
          <button class="btn btn-danger btn-sm" (click)="deleteMessage(selectedMessage.id!)" title="Delete">
            <i class="fas fa-trash"></i>
            Delete
          </button>
          <button class="modal-close" (click)="closeModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="modal-body">
        <div class="message-details">
          <div class="detail-row">
            <label>From:</label>
            <span>{{ selectedMessage.name }}</span>
          </div>
          <div class="detail-row">
            <label>Email:</label>
            <span>{{ selectedMessage.email }}</span>
          </div>
          <div class="detail-row">
            <label>Subject:</label>
            <span>{{ selectedMessage.subject }}</span>
          </div>
          <div class="detail-row">
            <label>Date:</label>
            <span>{{ getTimeAgo(selectedMessage.timestamp) }}</span>
          </div>
          <div class="detail-row full-width">
            <label>Message:</label>
            <div class="message-text">
              {{ selectedMessage.message }}
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">
          Close
        </button>
        <a [attr.href]="'https://mail.google.com/mail/?view=cm&fs=1&to=' + selectedMessage.email + '&su=Re: ' + selectedMessage.subject"
          target="_blank" class="btn btn-primary">
          <i class="fas fa-reply"></i>
          Reply 
        </a>
      </div>
    </div>
  </div>
  }
</div>