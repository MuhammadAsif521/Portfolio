<div class="projects-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Projects Management</h1>
      <p>Manage your portfolio projects - add, edit, and delete projects</p>
    </div>
    <button class="btn btn-primary add-btn" (click)="openAddModal()">
      <i class="fas fa-plus"></i>
      Add New Project
    </button>
  </div>

  <!-- Projects Table -->
  <div class="projects-table-container">
    @if (projects.length > 0) {
      <div class="table-responsive">
        <table class="projects-table">
          <thead>
            <tr>
              <th>Image</th>
              <th>Title</th>
              <th>Category</th>
              <th>Status</th>
              <th>Date</th>
              <th>Featured</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (project of projects; track project.id) {
              <tr>
                <td class="project-image-cell">
                  <img [src]="project.image" [alt]="project.title" class="project-thumbnail">
                </td>
                <td class="project-title-cell">
                  <h4>{{ project.title }}</h4>
                  <p>{{ project.description.substring(0, 60) }}...</p>
                </td>
                <td class="project-category-cell">
                  <span class="category-badge">
                    <i [class]="project.categoryIcon"></i>
                    {{ project.category | titlecase }}
                  </span>
                </td>
                <td class="project-status-cell">
                  <span class="status-badge" [style.background-color]="getStatusColor(project.status)">
                    {{ project.status | titlecase }}
                  </span>
                </td>
                <td class="project-date-cell">
                  {{ formatDate(project.createdAt) }}
                </td>
                <td class="project-featured-cell">
                  @if (project.featured) {
                    <i class="fas fa-star featured-icon"></i>
                  } @else {
                    <i class="far fa-star not-featured-icon"></i>
                  }
                </td>
                <td class="project-actions-cell">
                  <div class="action-buttons">
                    <button class="btn btn-secondary btn-sm" (click)="openEditModal(project)" title="Edit">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="deleteProject(project.id!)" title="Delete">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="empty-state">
        <i class="fas fa-folder-open"></i>
        <h3>No Projects Yet</h3>
        <p>Start by adding your first project to showcase your work.</p>
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="fas fa-plus"></i>
          Add First Project
        </button>
      </div>
    }
  </div>

  <!-- Project Modal -->
  @if (isModalOpen) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ isEditing ? 'Edit Project' : 'Add New Project' }}</h2>
          <button class="modal-close" (click)="closeModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form [formGroup]="projectForm" (ngSubmit)="onSubmit()" class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label for="title">Project Title</label>
              <input
                type="text"
                id="title"
                formControlName="title"
                [class.error]="isFieldInvalid('title')"
                placeholder="Enter project title"
              >
              @if (isFieldInvalid('title')) {
                <div class="error-message">{{ getFieldError('title') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="category">Category</label>
              <select
                id="category"
                formControlName="category"
                [class.error]="isFieldInvalid('category')"
                (change)="onCategoryChange()"
              >
                <option value="">Select category</option>
                @for (option of categoryOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
              @if (isFieldInvalid('category')) {
                <div class="error-message">{{ getFieldError('category') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="status">Status</label>
              <select
                id="status"
                formControlName="status"
                [class.error]="isFieldInvalid('status')"
              >
                <option value="">Select status</option>
                @for (option of statusOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
              @if (isFieldInvalid('status')) {
                <div class="error-message">{{ getFieldError('status') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="date">Date</label>
              <input
                type="date"
                id="date"
                formControlName="date"
                [class.error]="isFieldInvalid('date')"
              >
              @if (isFieldInvalid('date')) {
                <div class="error-message">{{ getFieldError('date') }}</div>
              }
            </div>

            <div class="form-group full-width">
              <label for="description">Description</label>
              <textarea
                id="description"
                formControlName="description"
                rows="4"
                [class.error]="isFieldInvalid('description')"
                placeholder="Describe your project..."
              ></textarea>
              @if (isFieldInvalid('description')) {
                <div class="error-message">{{ getFieldError('description') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="image">Image URL</label>
              <input
                type="url"
                id="image"
                formControlName="image"
                [class.error]="isFieldInvalid('image')"
                placeholder="https://example.com/image.jpg"
              >
              @if (isFieldInvalid('image')) {
                <div class="error-message">{{ getFieldError('image') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="liveUrl">Live URL</label>
              <input
                type="url"
                id="liveUrl"
                formControlName="liveUrl"
                [class.error]="isFieldInvalid('liveUrl')"
                placeholder="https://example.com"
              >
              @if (isFieldInvalid('liveUrl')) {
                <div class="error-message">{{ getFieldError('liveUrl') }}</div>
              }
            </div>

            <div class="form-group">
              <label for="codeUrl">Code URL</label>
              <input
                type="url"
                id="codeUrl"
                formControlName="codeUrl"
                [class.error]="isFieldInvalid('codeUrl')"
                placeholder="https://github.com/username/repo"
              >
              @if (isFieldInvalid('codeUrl')) {
                <div class="error-message">{{ getFieldError('codeUrl') }}</div>
              }
            </div>

            <div class="form-group full-width">
              <label for="technologies">Technologies (comma-separated)</label>
              <input
                type="text"
                id="technologies"
                formControlName="technologies"
                [class.error]="isFieldInvalid('technologies')"
                placeholder="Angular, TypeScript, Firebase, etc."
              >
              @if (isFieldInvalid('technologies')) {
                <div class="error-message">{{ getFieldError('technologies') }}</div>
              }
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="featured">
                <span class="checkmark"></span>
                Featured Project
              </label>
            </div>
          </div>

          @if (statusMessage) {
            <div class="form-status" [ngClass]="statusClass">
              <i [class]="statusClass === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
              {{ statusMessage }}
            </div>
          }

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
              @if (!isSubmitting) {
                <span>{{ isEditing ? 'Update' : 'Add' }} Project</span>
              }
              @if (isSubmitting) {
                <span class="loading-content">
                  <div class="loading-spinner"></div>
                  {{ isEditing ? 'Updating' : 'Adding' }}...
                </span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
